@{
    Layout = null;
}
<head>
    <!-- scripts and style sheets-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap4.min.js "></script>

    @*Loading Datatables to the page*@
    <link href="~/css/material.css" rel="stylesheet" />
    <link href="~/datatables/datatables.css" rel="stylesheet" />
    <title>CadViewer</title>

</head>

<div class="title dt-responsive">Viewer</div>

<div class="table-div">
    <br />
    <div style="width:90%; margin:0 auto;">
        <table id="prova" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th>MaterialID</th>
                    <th>Name</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div id="view-image" class="view-image"></div>

<script>
    $(document).ready(function () {
      /*  const diva = document.getElementById("view-image");
        const img = document.createElement("IMG");


        function showImageAndChildren(url, target) {
            showImage(url, target);
            //  showChildren();
        }

        function showImage(url, target) {
            img.src = url;
            target.appendChild(img);
            img.setAttribute("style", "width:100%");
            img.setAttribute("style", "height:100%");
            target.autoWidth;
        }
        */

        var table = $('#prova').DataTable();

     /*   table.row.add([
            "100","Luciano","Hello World"
        ]).draw();
        */


         $.ajax({
            url: "/Material/LoadData2",
            type: "POST",
            dataType: "JSON",
            success: function (result) {
                result.forEach(function (element) {
                    table.row.add(
                        [String(element.materialID), String(element.name), String(element.description)]
                    ).draw();
                    //console.log(element);
                });
            },

        });

        $('tbody').on('click', 'tr', function () {
           
            let riga = table.row(this);

            let currentParentId = riga.data()[0];

            let index = table.row(this).index();

            console.log("Hello There!!!   " + index);



//            $("#prova tbody tr").eq(index).after(newRow); 


            $.ajax({

                url: "/Material/LoadChild",
                type: "POST",
                dataType: "JSON",
                data: {
                    parMaterialId: currentParentId,
                },
                success: function (result) {
                    console.log(result);
                    result.forEach(function (element) {

                        var newRow = '<tr>' +
                            '<td>' + element.materialID + '</td> ' +
                            '<td>' + element.name + '</td>' +
                            '<td>' + element.description + '</td>' +
                            '</tr>';

                        $("#prova tbody tr").eq(index).after(newRow); 

/*                        table.row.add(
                            [element.materialID, element.name, element.description]
                        ).draw();*/
                       // console.log(element);
                    });
                },
                error: function () {
                    console.log("error con LoadChildAjax");
                }

            });
            
        });


/*        $('#prova').DataTable({
            retrieve: true,

            "ajax": {
                "url": "Material/InitialData",
                "type": "POST",
                "datatype": "json"
            },
            data: {
                varCode: 4,
            },
                      
/*            success: function (result) {
                table.row.add(result).draw();

                /*result.forEach(function (element) {
                    table.row.add({
                        "materialID": element.materialID,
                        "name": element.name,
                        "description": element.description
                    });
                    console.log(element);
                });
                console.log(result);
            },
            error: function () {
                $("#table-div").empty();
            }
            
        });*/

        /*






        $('#prova').DataTable({
            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "ajax": {
                "url": "Material/LoadData",
                "type": "POST",
                "datatype": "json"
            },
            "columns": [

                { "data": "materialID", "name": "materialID", "autoWidth": true },
                { "data": "name", "name": "name", "autoWidth": true },
                { "data": "description", "name": "description", "autoWidth": true }
                //   { "data": "imgUrl", "autoWidth": true }
                //   { "data": "children", "name":"children"}
                
            ]

        });
        
        setTimeout(() => {
            $.ajax({

                url: "/Material/LoadChild",
                type: "POST",
                dataType: "JSON",
                data: {
                    parMaterialId: 1,
                },
                success: function (result) {

                    table.rows.add(result).draw();
                    console.log(result);
                                        result.forEach(function (element) {
                                            table.row.add({
                                                "materialID": element.materialID,
                                                "name": element.name,
                                                "description": element.description
                                            });
                                            console.log(element);
                                        });
                },
                error: function () {
                    $("#table-div").empty();
                }

            });
        },1000


        );
        

        $('tbody').on('click', 'tr', function () {

            let riga = table.row(this);

            let currentParentId = riga.data().materialID;


            $.ajax({

                url: "/Material/LoadChild",
                type: "POST",
                dataType: "JSON",
                data: {
                    parMaterialId: currentParentId,
                },
                success: function (result) {

                    table.rows.add(result).draw();
                    console.log(result);
                    result.forEach(function (element) {
                        table.row.add({
                            "materialID": element.materialID,
                            "name": element.name,
                            "description": element.description
                        });
                        console.log(element);
                    });
                },
                error: function () {
                    $("#table-div").empty();
                }

            });*/

        //    table.draw();

/*            table.row.add({
                "materialID": 55,
                "name": "nameTest",
                "description": "DescriptionTest"
            });
*/
/*            if (riga.child.isShown()) {
                // This row is already open - close it
                riga.child.hide();
            }
            else {
                // Open this row
//                riga.child(tabella).show();
            }
            */

      //  });

    });</script>