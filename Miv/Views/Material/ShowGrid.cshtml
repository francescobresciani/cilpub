@{
    Layout = null;
}

<!-- scripts and style sheets-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap4.min.js "></script>

<div class="table-div">
    <br />
    <div style="width:90%; margin:0 auto;">
        <table id="prova" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th>MaterialID</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Children</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div id="view-image" class="view-image"></div>





@*Loading Datatables to the page*@
<link href="~/css/material.css" rel="stylesheet" />
<link href="~/datatables/datatables.css" rel="stylesheet" />


<script>
    $(document).ready(function () {
        const diva = document.getElementById("view-image");
        const img = document.createElement("IMG");


        function showImageAndChildren(url, target) {
            showImage(url, target);
            //  showChildren();
        }

        function showImage(url, target) {
            img.src = url;
            target.appendChild(img);
            img.setAttribute("style", "width:100%");
            img.setAttribute("style", "height:100%");
            target.autoWidth;
        }

        /* function showChildren(){
             console.log("showing children");

         }

         /* Formatting function for row details - modify as you need */
        function format(d) {
            // `d` is the original data object for the row
            return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">' +
                '<thead>'+
                '<tr>' +
                '<th>Id:</th>' +
                '<th>Name:</th>' +
                '<th>Description:</th>' +
                '</tr>' +
                '</thead>' +
                '<tbody>' +
                '<tr>' +
                '<td>' + d.materialID + '</td>' +
                '<td>' + d.name + '</td>' +
                '<td>' + d.materialID + '</td>' +
                '</tr>' +
                '</tbody>' +
                '</table>';
        }

        var original = $('#prova');

        var table = original.DataTable({
            "processing": true, // for show progress bar
            "serverSide": true, // for process server side
            "filter": true, // this is for disable filter (search box)
            "orderMulti": false, // for disable multiple column at once
            "ajax": {
                "url": "Material/LoadData",
                "type": "POST",
                "datatype": "json"
            },
            "columns": [

                { "data": "materialID", "name": "materialID", "autoWidth": true },
                { "data": "name", "name": "name", "autoWidth": true },
                { "data": "description", "name": "description", "autoWidth": true }
                //   { "data": "imgUrl", "autoWidth": true }
                //   { "data": "children", "name":"children"}

            ]

        });

        $('#prova tbody').on('click', 'tr', function () {

            var riga = table.row(this);

            let currentParentId = riga.data().materialID;

            var tabella = document.createElement("table");

            var selrow = $(this).closest('tr');

            let tableChildren = $.ajax({

                url: "/Material/LoadChild",
                type: "POST",
                dataType: "JSON",
                data: {
                    parMaterialId: currentParentId,
                },
                success: function (result) {
                    

                    result.forEach(function (element) {
                        //                        $("<tr> <td>" + element.materialID + "</td></tr>").insertAfter(selrow);
                        
                        $("<tr><td>" + element.materialID + "</td> <td>"+ element.name + "</td></tr>").insertAfter(tabella);
                        
                    });
                    
                  //  $("#table-div").empty();
 //                   result.forEach(function (element) {
                   //     console.log(element);

                        //$("#table-div").append("<p>" + element.name + "</p>");

//                    });
                },
                error: function () {
                    $("#table-div").empty();
                }

            });

            if (riga.child.isShown()) {
                // This row is already open - close it
                riga.child.hide();
            
                //tr.removeClass('shown');
            }
            else {
                // Open this row
                //riga.child(format(tableChildren)).show();
          
                riga.child(tabella).show();
                //riga.child("hello2").show();
                //tr.addClass('shown');
            }



           

            //rowing = tableChildren[0];


//            console.log('table2 ' + tableChildren);
            
            //    riga.child(tableChildren.rows().data).show());

            // Add event listener for opening and closing details
            /*    $('#example tbody').on('click', 'td.details-control', function () {
                    var tr = $(this).closest('tr');
                    var row = table.row(tr);

                    if (row.child.isShown()) {
                        // This row is already open - close it
                        row.child.hide();
                        tr.removeClass('shown');
                    }
                    else {
                        // Open this row
                        row.child(format(row.data())).show();
                        tr.addClass('shown');
                    }
                });
                */

        });

    });</script>